# Example application properties for auth-service
# Copy this file to application.properties and adjust values for your environment.
# IMPORTANT: do NOT commit real secrets. Use environment variables or your CI secret store.

# Application name
spring.application.name=auth-service

# === Keycloak / OIDC settings ===
# Issuer URI must include realm path, for example: http://localhost:8080/realms/microservice
app.security.issuer-uri=${KEYCLOAK_ISSUER_URI:http://localhost:8080/realms/microservice}
app.security.jwk-set-uri=${KEYCLOAK_JWK_SET_URI:${app.security.issuer-uri}/protocol/openid-connect/certs}
app.security.client-id=${KEYCLOAK_CLIENT_ID:auth-service}
# Provide the client secret via env var KEYCLOAK_CLIENT_SECRET in production
app.security.client-secret=${KEYCLOAK_CLIENT_SECRET:}
app.security.realm=${KEYCLOAK_REALM:microservice}

# Resource/audience used by downstream microservices
app.security.resource-id=${KEYCLOAK_RESOURCE_ID:auth-api}

# Optional scopes
app.security.scope.sso=${AUTH_SCOPE_SSO:openid}
app.security.scope.mfa=${AUTH_SCOPE_MFA:mfa}

# Server port
server.port=${SERVER_PORT:8082}

# Spring Security resource server
spring.security.oauth2.resourceserver.jwt.issuer-uri=${app.security.issuer-uri}
spring.security.oauth2.resourceserver.jwt.jwk-set-uri=${app.security.jwk-set-uri}

# Spring Security OAuth2 client registration (used by Swagger UI and optional clients)
spring.security.oauth2.client.registration.keycloak.client-id=${app.security.client-id}
# The registration client-secret references the same client secret variable above
spring.security.oauth2.client.registration.keycloak.client-secret=${app.security.client-secret}
spring.security.oauth2.client.registration.keycloak.scope=${app.security.scope.sso}
spring.security.oauth2.client.registration.keycloak.authorization-grant-type=authorization_code
spring.security.oauth2.client.registration.keycloak.redirect-uri={baseUrl}/login/oauth2/code/{registrationId}

# Provider must point to the full issuer (including realm)
spring.security.oauth2.client.provider.keycloak.issuer-uri=${app.security.issuer-uri}

# Management endpoints
management.endpoints.web.exposure.include=health,info

# Admin client for user management (used by /logup endpoint)
# Provide admin client id/secret via environment variables. Do NOT hardcode secrets in repo.
app.security.admin-client-id=${KEYCLOAK_ADMIN_CLIENT_ID:auth-service}
app.security.admin-client-secret=${KEYCLOAK_ADMIN_CLIENT_SECRET:}

# NOTES:
# - To keep secrets out of the repo, set KEYCLOAK_CLIENT_SECRET and KEYCLOAK_ADMIN_CLIENT_SECRET in your environment
#   or in your deployment platform's secret store.
# - Example environment variables (PowerShell):
#     $env:KEYCLOAK_ISSUER_URI = 'http://localhost:8080/realms/microservice'
#     $env:KEYCLOAK_CLIENT_SECRET = 'your-client-secret-here'
#     $env:KEYCLOAK_ADMIN_CLIENT_SECRET = 'your-admin-client-secret-here'
# - For local testing you can temporarily set the admin secret here, but do not commit it.
# - If Keycloak is not reachable during tests/build, consider mocking or skipping OAuth2 client auto-configuration in tests.

